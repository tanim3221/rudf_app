<html>
<head>
<title>WebviewActivity.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #000080; font-weight: bold;}
.s1 { color: #000000;}
.s2 { color: #008000; font-weight: bold;}
.s3 { color: #0000ff;}
.s4 { color: #808080; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
WebviewActivity.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span>com.icche.aisdatabase;

<span class="s0">import </span>android.annotation.TargetApi;
<span class="s0">import </span>android.content.Context;
<span class="s0">import </span>android.content.DialogInterface;
<span class="s0">import </span>android.content.Intent;
<span class="s0">import </span>android.content.pm.PackageManager;
<span class="s0">import </span>android.graphics.Bitmap;
<span class="s0">import </span>android.graphics.Color;
<span class="s0">import </span>android.net.ConnectivityManager;
<span class="s0">import </span>android.net.NetworkInfo;
<span class="s0">import </span>android.net.Uri;
<span class="s0">import </span>android.os.Build;
<span class="s0">import </span>android.os.Bundle;
<span class="s0">import </span>android.os.Handler;
<span class="s0">import </span>android.text.SpannableStringBuilder;
<span class="s0">import </span>android.text.Spanned;
<span class="s0">import </span>android.text.style.ForegroundColorSpan;
<span class="s0">import </span>android.view.View;
<span class="s0">import </span>android.view.WindowManager;
<span class="s0">import </span>android.webkit.WebResourceError;
<span class="s0">import </span>android.webkit.WebResourceRequest;
<span class="s0">import </span>android.webkit.WebSettings;
<span class="s0">import </span>android.webkit.WebView;
<span class="s0">import </span>android.webkit.WebViewClient;
<span class="s0">import </span>android.widget.FrameLayout;
<span class="s0">import </span>android.widget.Toast;

<span class="s0">import </span>androidx.appcompat.app.AlertDialog;
<span class="s0">import </span>androidx.appcompat.app.AppCompatActivity;
<span class="s0">import </span>androidx.appcompat.widget.Toolbar;
<span class="s0">import </span>androidx.swiperefreshlayout.widget.SwipeRefreshLayout;

<span class="s0">import </span>com.blog.library.UpdateChecker;

<span class="s0">public class </span>WebviewActivity <span class="s0">extends </span>AppCompatActivity {

    Toolbar toolbar = <span class="s0">null</span>;
    String db_url = <span class="s2">&quot;http://aisru.cf&quot;</span>;
    String fbapp = <span class="s2">&quot;fb://group/49880688703&quot;</span>;
    String fburl = <span class="s2">&quot;https://www.facebook.com/groups/bfdf.ru/&quot;</span>;
    String pageApp = <span class="s2">&quot;fb://page/169680089735915&quot;</span>;
    String pageurl = <span class="s2">&quot;https://www.facebook.com/rubfdf/&quot;</span>;
    <span class="s0">private </span>WebView webView = <span class="s0">null</span>;
    <span class="s0">private </span>SwipeRefreshLayout swipeRefreshLayout;
    <span class="s0">private </span>Context liContext = <span class="s0">null</span>;

    <span class="s0">public static boolean </span>isAppInstalled(Context context, String packageName) {
        <span class="s0">try </span>{
            context.getPackageManager().getApplicationInfo(packageName, <span class="s3">0</span>);
            <span class="s0">return true</span>;
        } <span class="s0">catch </span>(PackageManager.NameNotFoundException e) {
            <span class="s0">return false</span>;
        }
    }

    <span class="s0">public static boolean </span>isNetworkStatusAvialable(Context context) {
        ConnectivityManager connectivityManager =
                (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);
        <span class="s0">if </span>(connectivityManager != <span class="s0">null</span>) {
            NetworkInfo netInfos = connectivityManager.getActiveNetworkInfo();
            <span class="s0">if </span>(netInfos != <span class="s0">null</span>)
                <span class="s0">return </span>netInfos.isConnected();
        }
        <span class="s0">return false</span>;
    }

    @Override
    <span class="s0">protected void </span>onCreate(Bundle savedInstanceState) {
        <span class="s0">super</span>.onCreate(savedInstanceState);

        <span class="s0">if </span>(isNetworkStatusAvialable(getApplicationContext())) {

            <span class="s0">if </span>(Build.VERSION.SDK_INT &lt; <span class="s3">22</span>) {
                getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,
                        WindowManager.LayoutParams.FLAG_FULLSCREEN);
            }
            setContentView(R.layout.activity_webview);
            String url = db_url;
            liContext = <span class="s0">this</span>.getApplicationContext();
            FrameLayout frameLayout = findViewById(R.id.layout);
            <span class="s0">final </span>WebView webView = frameLayout.findViewById(R.id.webView);
            <span class="s4">/*  final ProgressBar progress = frameLayout.findViewById(R.id.progress);*/</span>
            <span class="s0">final </span>SwipeRefreshLayout swipeRefreshLayout = frameLayout.findViewById(R.id.swipe);
            swipeRefreshLayout.setColorSchemeResources(R.color.colorPrimary);
            swipeRefreshLayout.setRefreshing(<span class="s0">true</span>);
            swipeRefreshLayout.setOnRefreshListener(<span class="s0">new </span>SwipeRefreshLayout.OnRefreshListener() {
                @Override
                <span class="s0">public void </span>onRefresh() {
                    webView.reload();
                }
            });

       <span class="s4">/* //progressbar tinting color 
        if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.KITKAT) { 
            Drawable wrapDrawable = DrawableCompat.wrap(progress.getIndeterminateDrawable()); 
            DrawableCompat.setTint(wrapDrawable, ContextCompat.getColor(getApplicationContext(), 
                    R.color.colorPrimary)); 
            progress.setIndeterminateDrawable(DrawableCompat.unwrap(wrapDrawable)); 
 
        } else { 
            progress.getIndeterminateDrawable().setColorFilter(ContextCompat.getColor(getApplicationContext(), R.color.colorPrimary), PorterDuff.Mode.SRC_IN); 
        } 
        //progressbar tinting color*/</span>
           <span class="s0">new </span>Handler().postDelayed(<span class="s0">new </span>Runnable() {
                    @Override
                    <span class="s0">public void </span>run() {
                        UpdateChecker.checkForDialog(WebviewActivity.<span class="s0">this</span>);
                    }
                }, <span class="s3">1</span>);

            WebSettings webSettings = webView.getSettings();
            webView.getSettings().setSupportZoom(<span class="s0">false</span>);
            webView.getSettings().setBuiltInZoomControls(<span class="s0">false</span>);
            webView.getSettings().setDisplayZoomControls(<span class="s0">false</span>);
            webView.getSettings().setLoadWithOverviewMode(<span class="s0">true</span>);
            webView.getSettings().setUseWideViewPort(<span class="s0">true</span>);
            webView.getSettings().setJavaScriptEnabled(<span class="s0">true</span>);
            webView.getSettings().setAppCacheMaxSize(<span class="s3">10 </span>* <span class="s3">1024 </span>* <span class="s3">1024</span>);
            webView.getSettings().setAppCachePath(getApplicationContext().getCacheDir().getAbsolutePath());
            webView.getSettings().setAllowFileAccess(<span class="s0">true</span>);
            webView.getSettings().setAppCacheEnabled(<span class="s0">true</span>);
            webView.setScrollBarStyle(WebView.SCROLLBARS_INSIDE_OVERLAY);
            webSettings.setLayoutAlgorithm(WebSettings.LayoutAlgorithm.SINGLE_COLUMN);
            webView.setScrollbarFadingEnabled(<span class="s0">true</span>);
            <span class="s0">if </span>(isNetworkStatusAvialable(getApplicationContext())) {
                webView.getSettings().setCacheMode(WebSettings.LOAD_DEFAULT);
            } <span class="s0">else </span>{
                webView.getSettings().setCacheMode(WebSettings.LOAD_CACHE_ONLY);
            }
            webView.setWebViewClient(<span class="s0">new </span>WebViewClient());
            webView.loadUrl(url);
            webView.setOnLongClickListener(<span class="s0">new </span>View.OnLongClickListener() {
                @Override
                <span class="s0">public boolean </span>onLongClick(View v) {
                    <span class="s0">return true</span>;
                }

            });
            webView.setWebViewClient(<span class="s0">new </span>WebViewClient() {

                @Override
                <span class="s0">public void </span>onReceivedError(WebView view, <span class="s0">int </span>errorCode, String description,
                                            String failingUrl) {
                    webView.loadUrl(<span class="s2">&quot;about:blank&quot;</span>);
                    <span class="s0">super</span>.onReceivedError(view, errorCode, description, failingUrl);
                }

                @Override
                @TargetApi(Build.VERSION_CODES.M)
                <span class="s0">public void </span>onReceivedError(WebView view, WebResourceRequest request, WebResourceError error) {
                    webView.loadUrl(<span class="s2">&quot;about:blank&quot;</span>);
                    <span class="s0">super</span>.onReceivedError(view, request, error);
                }

                <span class="s0">public boolean </span>shouldOverrideUrlLoading(WebView view, String url) {

                    <span class="s0">if </span>(url.startsWith(<span class="s2">&quot;tel:&quot;</span>)) {
                        Intent intent = <span class="s0">new </span>Intent(Intent.ACTION_DIAL, Uri.parse(url));
                        startActivity(intent);

                        Toast.makeText(getApplicationContext(), (getString(R.string.call_toast)),
                                Toast.LENGTH_LONG).show();

                        <span class="s0">return true</span>;

                    } <span class="s0">else if </span>(url.startsWith(<span class="s2">&quot;mailto:&quot;</span>)) {
                        <span class="s0">if </span>(isNetworkStatusAvialable(getApplicationContext())) {
                            Intent intent = <span class="s0">new </span>Intent(Intent.ACTION_SENDTO, Uri.parse(url));
                            startActivity(intent);
                            Toast.makeText(getApplicationContext(), (getString(R.string.email_toast)),
                                    Toast.LENGTH_LONG).show();
                        } <span class="s0">else </span>{

                            String titleText = getString(R.string.email_dialog);
                            ForegroundColorSpan foregroundColorSpan = <span class="s0">new </span>ForegroundColorSpan(Color.rgb(<span class="s3">140</span>, <span class="s3">140</span>, <span class="s3">140</span>));
                            SpannableStringBuilder color = <span class="s0">new </span>SpannableStringBuilder(titleText);
                            color.setSpan(foregroundColorSpan, <span class="s3">0</span>, titleText.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
                            AlertDialog.Builder builder = <span class="s0">new </span>AlertDialog.Builder(WebviewActivity.<span class="s0">this</span>);
                            builder.setTitle(getString(R.string.connect_net))
                                    .setMessage(color)
                                    <span class="s4">/*   .setNegativeButton(getString(R.string.ok_btn), null)*/</span>
                                    .setCancelable(<span class="s0">true</span>)
                                    .show();
                        }
                        <span class="s0">return true</span>;
                    } <span class="s0">else if </span>(url.startsWith(<span class="s2">&quot;fb:&quot;</span>)) {
                        <span class="s0">if </span>(isNetworkStatusAvialable(getApplicationContext())) {
                            <span class="s0">if </span>(isAppInstalled(liContext, <span class="s2">&quot;com.facebook.orca&quot;</span>) || isAppInstalled(liContext, <span class="s2">&quot;com.facebook.katana&quot;</span>)
                                    || isAppInstalled(liContext, <span class="s2">&quot;com.example.facebook&quot;</span>) || isAppInstalled(liContext, <span class="s2">&quot;com.facebook.android&quot;</span>)) {
                                Intent intent = <span class="s0">new </span>Intent(Intent.ACTION_VIEW, Uri.parse(url));
                                startActivity(intent);
                                Toast.makeText(getApplicationContext(), (getString(R.string.facebook_view)),
                                        Toast.LENGTH_LONG).show();
                            } <span class="s0">else </span>{
                                Toast.makeText(getApplicationContext(), (getString(R.string.not_fb)),
                                        Toast.LENGTH_LONG).show();
                            }

                        } <span class="s0">else </span>{
                            String titleText = getString(R.string.fb_pro);
                            ForegroundColorSpan foregroundColorSpan = <span class="s0">new </span>ForegroundColorSpan(Color.rgb(<span class="s3">140</span>, <span class="s3">140</span>, <span class="s3">140</span>));
                            SpannableStringBuilder color = <span class="s0">new </span>SpannableStringBuilder(titleText);
                            color.setSpan(foregroundColorSpan, <span class="s3">0</span>, titleText.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
                            AlertDialog.Builder builder = <span class="s0">new </span>AlertDialog.Builder(WebviewActivity.<span class="s0">this</span>);
                            builder.setTitle(getString(R.string.connect_net))
                                    .setMessage(color)
                                    <span class="s4">/*  .setNegativeButton(getString(R.string.ok_btn), null)*/</span>
                                    .setCancelable(<span class="s0">true</span>)
                                    .show();
                        }
                        <span class="s0">return true</span>;
                    } <span class="s0">else </span>{
                        view.loadUrl(url);
                        <span class="s0">return true</span>;
                    }

                }

                <span class="s0">public void </span>onPageStarted(WebView view, String url, Bitmap favicon) {
                    <span class="s0">super</span>.onPageStarted(view, url, favicon);
                    swipeRefreshLayout.setRefreshing(<span class="s0">true</span>);
                }

                <span class="s0">public void </span>onPageFinished(WebView view, String url) {
                    swipeRefreshLayout.setRefreshing(<span class="s0">false</span>);
                    <span class="s0">super</span>.onPageFinished(view, url);
                }
            });
        } <span class="s0">else </span>{
            String titleText = getString(R.string.error_net);
            ForegroundColorSpan foregroundColorSpan = <span class="s0">new </span>ForegroundColorSpan(Color.rgb(<span class="s3">140</span>, <span class="s3">140</span>, <span class="s3">140</span>));
            SpannableStringBuilder color = <span class="s0">new </span>SpannableStringBuilder(titleText);
            color.setSpan(foregroundColorSpan, <span class="s3">0</span>, titleText.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
            AlertDialog.Builder builder = <span class="s0">new </span>AlertDialog.Builder(WebviewActivity.<span class="s0">this</span>);
            builder.setTitle(getString(R.string.connect_net))
                    .setMessage(color)
                    .setIcon(getResources().getDrawable(R.drawable.ic_wifi_off))
                    .setNegativeButton(getString(R.string.cancel), <span class="s0">new </span>DialogInterface.OnClickListener() {
                        @Override
                        <span class="s0">public void </span>onClick(DialogInterface dialog, <span class="s0">int </span>i) {
                            onBackPressed();
                        }
                    })
                    .setPositiveButton(getString(R.string.retry_btn), <span class="s0">new </span>DialogInterface.OnClickListener() {
                        @Override
                        <span class="s0">public void </span>onClick(DialogInterface dialog, <span class="s0">int </span>which) {
                            finish();
                            startActivity(getIntent());
                        }
                    })
                    .setCancelable(<span class="s0">false</span>)
                    .show();
        }
    }

}
</pre>
</body>
</html>